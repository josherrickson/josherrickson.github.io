<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Frames | Stata 16 - New Features</title>
  <meta name="description" content="Chapter 2 Frames | Stata 16 - New Features" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Frames | Stata 16 - New Features" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Frames | Stata 16 - New Features" />
  
  
  

<meta name="author" content="Josh Errickson" />


<meta name="date" content="2019-09-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="variable-lists.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="css/standard_html.css" type="text/css" />
<link rel="stylesheet" href="css/book.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">Stata 16 - New Features</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#how-to-use-this-document"><i class="fa fa-check"></i><b>1.1</b> How to use this document</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#contact-information"><i class="fa fa-check"></i><b>1.2</b> Contact information</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#cscar"><i class="fa fa-check"></i><b>1.2.1</b> CSCAR</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#author"><i class="fa fa-check"></i><b>1.2.2</b> Author</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#usage"><i class="fa fa-check"></i><b>1.3</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="frames.html"><a href="frames.html"><i class="fa fa-check"></i><b>2</b> Frames</a><ul>
<li class="chapter" data-level="2.1" data-path="frames.html"><a href="frames.html#when-might-you-use-frames"><i class="fa fa-check"></i><b>2.1</b> When might you use frames?</a></li>
<li class="chapter" data-level="2.2" data-path="frames.html"><a href="frames.html#the-basics"><i class="fa fa-check"></i><b>2.2</b> The basics</a></li>
<li class="chapter" data-level="2.3" data-path="frames.html"><a href="frames.html#aliases"><i class="fa fa-check"></i><b>2.3</b> Aliases</a></li>
<li class="chapter" data-level="2.4" data-path="frames.html"><a href="frames.html#remember-to-drop-frames"><i class="fa fa-check"></i><b>2.4</b> Remember to drop frames!</a></li>
<li class="chapter" data-level="2.5" data-path="frames.html"><a href="frames.html#copying-into-frames"><i class="fa fa-check"></i><b>2.5</b> Copying into frames</a></li>
<li class="chapter" data-level="2.6" data-path="frames.html"><a href="frames.html#executing-commands-in-a-different-frame"><i class="fa fa-check"></i><b>2.6</b> Executing commands in a different frame</a></li>
<li class="chapter" data-level="2.7" data-path="frames.html"><a href="frames.html#linking-data-sets"><i class="fa fa-check"></i><b>2.7</b> Linking data sets</a><ul>
<li class="chapter" data-level="2.7.1" data-path="frames.html"><a href="frames.html#working-with-linked-frames"><i class="fa fa-check"></i><b>2.7.1</b> Working with linked frames</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="variable-lists.html"><a href="variable-lists.html"><i class="fa fa-check"></i><b>3</b> Variable Lists</a><ul>
<li class="chapter" data-level="3.1" data-path="variable-lists.html"><a href="variable-lists.html#initialization-of-variable-lists"><i class="fa fa-check"></i><b>3.1</b> Initialization of Variable Lists</a></li>
<li class="chapter" data-level="3.2" data-path="variable-lists.html"><a href="variable-lists.html#viewing-lists"><i class="fa fa-check"></i><b>3.2</b> Viewing lists</a><ul>
<li class="chapter" data-level="3.2.1" data-path="variable-lists.html"><a href="variable-lists.html#moving-variables-in-system-lists"><i class="fa fa-check"></i><b>3.2.1</b> Moving variables in system lists</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="variable-lists.html"><a href="variable-lists.html#user-variable-lists"><i class="fa fa-check"></i><b>3.3</b> User Variable Lists</a><ul>
<li class="chapter" data-level="3.3.1" data-path="variable-lists.html"><a href="variable-lists.html#modifying-user-variable-lists"><i class="fa fa-check"></i><b>3.3.1</b> Modifying User Variable Lists</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="variable-lists.html"><a href="variable-lists.html#dropping-variable-list"><i class="fa fa-check"></i><b>3.4</b> Dropping variable list</a></li>
<li class="chapter" data-level="3.5" data-path="variable-lists.html"><a href="variable-lists.html#using-variable-lists"><i class="fa fa-check"></i><b>3.5</b> Using Variable Lists</a><ul>
<li class="chapter" data-level="3.5.1" data-path="variable-lists.html"><a href="variable-lists.html#updating-factor-variable-lists"><i class="fa fa-check"></i><b>3.5.1</b> Updating factor-variable Lists</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="variable-lists.html"><a href="variable-lists.html#stored-statistics"><i class="fa fa-check"></i><b>3.6</b> Stored Statistics</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stata 16 - New Features</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="frames" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Frames</h1>
<p>
Prior to Stata 16, one infamous unique aspect of Stata was support for only one data set at a time. If you wanted to work with multiple data-sets, you either needed to <a target="_blank" href="https://www.stata.com/manuals/dmerge.pdf"><code>merge</code></a> or <a target="_blank" href="https://www.stata.com/manuals/dappend.pdf"><code>append</code></a> the data sets together if there was a natural connection between them, or be frequently opening and closing data or using <a target="_blank" href="https://www.stata.com/manuals/ppreserve.pdf"><code>preserve</code> and <code>restore</code></a> to jump between them.
</p>
<p>
Frames are Stata’s approach to handling multiple data sets. You can now have multiple frames, each with their own data, which you can move between with ease, and even transfer variables between.
</p>
<div id="when-might-you-use-frames" class="section level2">
<h2><span class="header-section-number">2.1</span> When might you use frames?</h2>
<ul>
<li>
Interruptions - You’re working on a project, and someone asks you to do something on another data set. You can open the other data set in a new frame, do whatever is needed, then swap back to your current project without any loss.
</li>
<li>
Destructive data manipulations - If you need to do something destructive, you can copy your current data to a new frame and do the destructive operations there.
</li>
<li>
Linked data sets - When you have data that is linked, rather than merging, you can link the two frames together. (Either at the same level - e.g. pre &amp; post survey for individuals; or at different levels - e.g. a person data set and a city data set.)
</li>
<li>
Collate model results - When using <a target="_blank" href="https://www.stata.com/manuals/pmatrixmkmat.pdf"><code>svmat</code></a> after running a model to place the model results in the data, place those results in a new frame instead.
</li>
</ul>
</div>
<div id="the-basics" class="section level2">
<h2><span class="header-section-number">2.2</span> The basics</h2>
<p>
The primary command for dealing with frames is, unsurprisingly, <code>frame</code> (or <code>frames</code>, either works). By itself, it will remind you of the current frame:
</p>
<pre><code>. frame
  (current frame is default)

</code></pre>
<p>
This tells us the name of the frame, the name of a new frame when starting Stata is “default”. There is nothing special about this name, we can easily rename the frame.
</p>
<pre><code>. frame rename default maindata

. frame
  (current frame is maindata)

</code></pre>
<p>
We can create a second data frame as well.
</p>
<pre><code>. frame create seconddata

. frame
  (current frame is maindata)

</code></pre>
<p>
Notice that we’re still in the “maindata” frame. We can jump between frames via <code>frame change</code>.
</p>
<pre><code>. frame change seconddata

. frame
  (current frame is seconddata)

. frame change otherdata
frame otherdata not found
r(111);

</code></pre>
<p>
Notice that the last command failed; we must create a frame before we can switch to it.
</p>
<p>
We can keep track of all our frames via <code>frame dir</code>.
</p>
<pre><code>. frame dir
  maindata    0 x 0
  seconddata  0 x 0

</code></pre>
<p>
The <code>0 x 0</code> is telling us that in neither frame has any data loaded. Let’s load some data to make this more interesting.
</p>
<pre><code>. sysuse auto
(1978 Automobile Data)

. frame change maindata

. sysuse bplong
(fictional blood-pressure data)

. frame dir
  maindata    240 x 5; fictional blood-pressure data
  seconddata  74 x 12; 1978 Automobile Data

</code></pre>
<p>
Now we can see what size the data is in each frame. The description next to each frame is set via <a target="_blank" href="https://www.stata.com/manuals/dlabel.pdf"><code>label data</code></a>, a previously not very useful trait that takes on new important in keeping track of which data is loaded in which frame.
</p>
</div>
<div id="aliases" class="section level2">
<h2><span class="header-section-number">2.3</span> Aliases</h2>
<p>
There are two aliases to keep track of.
</p>
<ol>
<li>
<code>pwf</code> (print working frame) is an alias for <code>frame</code>.
</li>
<li>
<code>cwf</code> (change working frame) is an alias for <code>frame change</code>.
</li>
</ol>
<p>
These aliases mimic <a target="_blank" href="https://www.stata.com/manuals/dcd.pdf"><code>pwd</code> and <code>cd</code></a>, Stata’s way of viewing and changing the current working directory.
</p>
</div>
<div id="remember-to-drop-frames" class="section level2">
<h2><span class="header-section-number">2.4</span> Remember to drop frames!</h2>
<p>
When you have data loaded into a frame, it is (like all data in Stata) loaded into your memory. That means if you open multiple very large data sets in frames, you can quickly run out of memory when you never had before.
</p>
<p>
Frames can be dropped via <code>frame drop</code> as you might guess.
</p>
<pre><code>. frame dir
  maindata    240 x 5; fictional blood-pressure data
  seconddata  74 x 12; 1978 Automobile Data

. frame drop seconddata

. frame dir
  maindata  240 x 5; fictional blood-pressure data

</code></pre>
<p>
While not a new command to Stata 16, the <a target="_blank" href="https://www.stata.com/manuals/dcompress.pdf"><code>compress</code></a> command can be very handy as it will attempt to shrink the size of the data as much as possible. This process is non-destructive, so there is no harm in running it.
</p>
<p>
To drop all frames and their data, and reset Stata to a single “default” frame,
</p>
<pre><code>. frame reset

. frame dir
  default  0 x 0

</code></pre>
<p>
Note that <code>clear frames</code> is an alias for <code>frame reset</code> and functions as well.
</p>
</div>
<div id="copying-into-frames" class="section level2">
<h2><span class="header-section-number">2.5</span> Copying into frames</h2>
<p>
The contents of the current frame can be transfered into a new (or overwrite an existing frame). This may be useful for performing destructive operations such as <code>collapse</code>.
</p>
<pre><code>. sysuse auto
(1978 Automobile Data)

. frame copy default newframe

. frame copy default newframe
frame newframe already defined
r(110);

. frame copy default newframe, replace

</code></pre>
<p>
As you can see, the <code>replace</code> is needed if the new frame already exists, regardless of whether that frame has data or not.
</p>
<p>
We can also selectively move data over.
</p>
<pre><code>. frame put mpg headroom, into(newframe2)

. frame dir
  default    74 x 12; 1978 Automobile Data
  newframe   74 x 12; 1978 Automobile Data
* newframe2  74 x 2; 1978 Automobile Data

Note: frames marked with * contain unsaved data

</code></pre>
<p>
Note that unlike <code>frame copy</code>, there is no <code>replace</code> option, meaning <code>frame put</code> <em>must</em> operate on an un-existing frame.
</p>
</div>
<div id="executing-commands-in-a-different-frame" class="section level2">
<h2><span class="header-section-number">2.6</span> Executing commands in a different frame</h2>
<p>
Switching between frames can become tedious if you do it often.
</p>
<pre><code>. frame change newframe2

. summarize

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         mpg |         74     21.2973    5.785503         12         41
    headroom |         74    2.993243    .8459948        1.5          5

. frame change default

</code></pre>
<p>
Instead, you can use the <code>frame:</code> prefix to execute a command in another frame without switching frames.
</p>
<pre><code>. frame newframe2: summarize

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         mpg |         74     21.2973    5.785503         12         41
    headroom |         74    2.993243    .8459948        1.5          5

</code></pre>
<p>
You can use curly braces to execute a chunk of code as well.
</p>
<pre><code>. frame newframe2 {
.   summarize

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         mpg |         74     21.2973    5.785503         12         41
    headroom |         74    2.993243    .8459948        1.5          5
.   describe, simple
mpg       headroom
. }

</code></pre>
</div>
<div id="linking-data-sets" class="section level2">
<h2><span class="header-section-number">2.7</span> Linking data sets</h2>
<p>
In addition to allowing multiple data sets to be open at a time, we can <strong>link</strong> frames together such that rows of data in each frames are connected to each-other and can inter-operate. This requires a linking variable in each data set which will connect the rows. The two data sets can be at the same levels or at different levels.
</p>
<p>
For example, we might have data sets collected from multiple waves of surveys and follow-ups during which the same people (modulo some non-responses) are contained in each data set. Then the person ID variable in the data sets would be the linking variable.
</p>
<p>
Another example might be one file at the person level, and another file at the city level. The linking variable would be city name, which would be unique in the city file, but could potentially be repeated in the person level file.
</p>
<p>
The command to link files is <code>frlink</code> and requires specifying both the linking variable(s) and the frame to link to.
</p>
<pre><code>frlink 1:1 linkvar, frame(otherframe)
</code></pre>
<p>
Let’s load some data from NHANES. Each file contains a row per subject.
</p>
<pre><code>. frame reset

. frame rename default demographics

. frame create diet

. frame create bp

. 
. import sasxport5 &quot;https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/DEMO_I.XPT&quot;, cle
&gt; ar

. frame diet: import sasxport5 &quot;https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/DR1T
&gt; OT_I.XPT&quot;, clear

. frame bp: import sasxport5 &quot;https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/BPX_I.
&gt; XPT&quot;, clear

. frame dir
* bp            9544 x 21
* demographics  9971 x 47
* diet          9544 x 168

Note: frames marked with * contain unsaved data

</code></pre>
<p>
So as you can see, the current frame is the “demographics” frame, and the other frames contains diet and blood pressure information. The variable <code>seqn</code> records person ID.
</p>
<pre><code>. frlink 1:1 seqn, frame(bp)
  (427 observations in frame demographics unmatched)

. frlink 1:1 seqn, frame(diet)
  (427 observations in frame demographics unmatched)

</code></pre>
<p>
The <code>1:1</code> subcommand specifies that it is a 1-to-1 link - each person has no more than 1 row of data in each file. An alternative is <code>m:1</code> which allows multiple rows in the main file to be linked to a single row in the second frame. <code>1:m</code> is <em>not allowed</em> at this point in time.
</p>
<p>
These commands created two new variables <code>bp</code> and <code>diet</code> (the same new as the linked frames) which indicate which row of the linked from is connected with the given row.
</p>
<pre><code>. list bp diet in 25/29

     +-----------+
     | bp   diet |
     |-----------|
 25. | 25     25 |
 26. | 26     26 |
 27. |  .      . |
 28. | 27     27 |
 29. | 28     28 |
     +-----------+

</code></pre>
<p>
Here we see that row 27 in the demographics file was not found in either “bp” or “diet” and thus has no entry in the <code>bp</code> or <code>diet</code> variables.
</p>
<p>
Links are tracked by the variables, we can see the current status of a link via <code>frlink describe</code>:
</p>
<pre><code>. frlink describe diet

  History:
  -----------------------------------------------------------------------------
    Link variable diet created on 26 Sep 2019 by

    . frlink 1:1 seqn, frame(diet)

    Frame diet contained an unnamed dataset
  -----------------------------------------------------------------------------
  Verifying linkage...
  Linkage is up to date.

</code></pre>
<p>
To unlink frames, simply drop the variable.
</p>
<pre><code>. drop diet

</code></pre>
<p>
Finally, the names of the created variables can be modified via the <code>generate</code> option to <code>frlink</code>:
</p>
<pre><code>. frlink 1:1 seqn, frame(diet) generate(linkdiet)
  (427 observations in frame demographics unmatched)

. frlink describe linkdiet

  History:
  -----------------------------------------------------------------------------
    Link variable linkdiet created on 26 Sep 2019 by

    . frlink 1:1 seqn, frame(diet) generate(linkdiet)

    Frame diet contained an unnamed dataset
  -----------------------------------------------------------------------------
  Verifying linkage...
  Linkage is up to date.

</code></pre>
<div id="working-with-linked-frames" class="section level3">
<h3><span class="header-section-number">2.7.1</span> Working with linked frames</h3>
<p>
Once we have linked frames, we can use variables in the linked frame in analyses on the main frame.
</p>
<p>
The <code>frget</code> command can copy variables from the linked frame into the primary frame.
</p>
<pre><code>. summarize bpxchr
variable bpxchr not found
r(111);

. frget bpxchr, from(bp)
(8,033 missing values generated)
  (1 variable copied from linked frame)

. summarize bpxchr

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      bpxchr |      1,938    106.5614    21.75754         58        190

</code></pre>
<p>
This merges appropriately, with a <code>1:1</code> or <code>m:1</code> link, to properly associate the values of the variable with the right observations.
</p>
<p>
Alternatively, when using <code>generate</code>, we can reference a variable in another frame.
</p>
<pre><code>. gen nonsense = frval(linkdiet, dr1tcalc)/frval(bp, bpxpls) + dmdhrage
(3,158 missing values generated)

</code></pre>
<p>
Note that this calculation used variables from all three frames. A less nonsensical example might be where we want the percent of a countries population located in a given state. Imagine we have the primary frame of county data, and then a separate frame “state” containing state level information.
</p>
<pre><code>gen percentpopulation = population/frval(state, population)
</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="variable-lists.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
